// Generated by CoffeeScript 1.10.0
var log;

log = require('printit')({
  prefix: 'init'
});

module.exports = function(app, server, callback) {
  var feed, indexer, init;
  feed = require('./lib/feed');
  feed.initialize(server);
  indexer = require('./lib/indexer');
  init = require('./lib/init');
  return init.removeDocWithoutDocType(function(err) {
    if (err != null) {
      log.error(err);
    }
    return init.removeLostBinaries(function(err) {
      if (err != null) {
        log.error(err);
      }
      return init.addThumbs(function(err) {
        if (err != null) {
          log.error(err);
        }
        return init.addAudioMeta(function(err) {
          if (err != null) {
            log.error(err);
          }
          return init.addAccesses(function(err) {
            if (err != null) {
              log.error(err);
            }
            return indexer.initialize(function(err) {
              if (err != null) {
                log.error(err);
              }
              if (callback != null) {
                return callback(app, server);
              }
            });
          });
        });
      });
    });
  });
};
