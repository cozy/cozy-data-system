// Generated by CoffeeScript 1.9.3
var httpError, locker, logger;

locker = require('../lib/locker');

logger = require('printit')({
  date: true,
  prefix: 'app:error'
});

module.exports = function(err, req, res, next) {
  var message, ref, statusCode;
  statusCode = err.status || ((ref = err.headers) != null ? ref.status : void 0) || 500;
  message = err instanceof Error ? err.message : err.error;
  if (err.code) {
    message = {
      message: message,
      code: err.code
    };
  }
  res.send(statusCode, {
    error: message
  });
  if (err instanceof Error) {
    logger.error(err.message);
    logger.error(err.stack);
  }
  if (req.lock != null) {
    return locker.removeLock(req.lock);
  }
};

module.exports.http = httpError = function(code, msg) {
  var err;
  err = new Error(msg);
  err.status = code;
  return err;
};

module.exports.notFound = function() {
  return httpError(404, 'Not Found');
};

module.exports.notAuthorized = function() {
  return httpError(403, 'Application is not authorized');
};

module.exports.noPassword = function() {
  return httpError(400, 'No password field in request\'s body');
};
